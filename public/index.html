<html>
<head>
  <title>Starbound on Raidbots</title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="http://starbound.raidbots.com/socket.io/socket.io.js"></script>
  <script>
    var userNotes = {
    };
    var addChatRow = function( who, what, when ) {
      $('#chatlog').append(
        '<tr>'+
          '<td>' + when + '</td>' +
          '<td>' + who + '</td>' +
          '<td>' + what + '</td>' +
        '</tr>'
      );
    }
    var setPlayersOnline = function( players ) {
      $('#players li').remove();
      $.each( players, function( key, val ) {
        note = val;
        if( userNotes[ val ] ) {
          note += " ("+userNotes[val]+")";
        }
        $('#players').append('<li>'+note+'</li>');
      });
    };

    var apiBase = 'http://starbound.raidbots.com';
    var socket = io.connect(apiBase);
    socket.on('chat',function(data){
      addChatRow( data.who, data.what, data.when );
    });
    socket.on('playerCount',function(data){
      setPlayersOnline( data.playersOnline );
    });
    $(document).ready(function(){
      // load server status
      $.get( apiBase + "/server/status", function( data ) {
        setPlayersOnline( data.playersOnline );
      });

      // load chat
      $.get( apiBase + "/server/chat", function( data ) {
        msgs = data.length;
        if( msgs < 10 ) {
          start = 0;
        } else {
          start = msgs - 10;
        }
        for( i = start; i < msgs; i++ ) {
          addChatRow( data[i].who, data[i].what, data[i].when );
        }
      });
    });
  </script>
</head>
<body>
  <h1>Raidbots Starbound</h1>

  <ul>
    <li>
      <a href="http://www.hipchat.com/go3b2huWp">Public HipChat Room</a>
    </li>
  </ul>

  <h2>Players Online:</h2>
  <ul id="players">
  </ul>

  <h2>Recent/Live Chat Log</h2>
  <table id="chatlog" border="1" cellspacing="0" cellpadding="4">
  </table>

  <h2>API</h2>

  <ul>
    <li><a href="http://starbound.raidbots.com/server/status">Server Status</a></li>
    <li><a href="http://starbound.raidbots.com/server/chat">Server Chat</a></li>
  </ul>
</body>
</html>
